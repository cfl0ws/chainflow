Setup Icinga2 instance in a ubuntu host

Run following commands in the node that you want to monitor
curl -sSL https://packages.icinga.com/icinga.key | sudo apt-key add -

echo 'deb https://packages.icinga.com/ubuntu icinga-cosmic main' | sudo tee -a /etc/apt/sources.list.d/icinga.list

sudo apt-get update

sudo apt-get install icinga2 -y

sudo ufw allow 5665

sudo icinga2 node wizard

Welcome to the Icinga 2 Setup Wizard!

We will guide you through all required configuration details.

Please specify if this is a satellite/client setup ('n' installs a master setup) [Y/n]:ENTER

Starting the Client/Satellite setup routine...

Please specify the common name (CN) [chainflow-cosmos-test-validator]: 10.147.18.185 (instance private IP)

Please specify the parent endpoint(s) (master or satellite) where this node should connect to:
Master/Satellite Common Name (CN from your master/satellite node): 103.3.62.216 (Icinga master public IP) Just for the CERT CA

Do you want to establish a connection to the parent node from this node? [Y/n]:ENTER
Please specify the master/satellite connection information:
Master/Satellite endpoint host (IP address or FQDN): 10.147.18.76 (Icinga master private IP) for connectivity
Master/Satellite endpoint port [5665]:ENTER

Add more master/satellite endpoints? [y/N]:ENTER
Parent certificate information:


 Subject:     CN = 103.3.62.216
 Issuer:      CN = Icinga CA
 Valid From:  Apr  9 18:21:22 2019 GMT
 Valid Until: Apr  5 18:21:22 2034 GMT
 Fingerprint: BD F2 D5 CD 6D 08 81 46 4E 35 85 F4 17 B1 3E B9 24 1D AA 23

Is this information correct? [y/N]: y

Please specify the request ticket generated on your Icinga 2 master (optional). Not optional and don’t enter
 (Hint: # icinga2 pki ticket --cn '172.104.149.69'): 34813c4b1f727ec30287e711be3d4f5d1c0fbee9   ←--
Login to the Icinga master host and run the command; Copy the output of that command and get the long string it returns. Past it and enter.
	icinga2 pki ticket --cn '10.147.18.76' (instance private IP)

Please specify the API bind host/port (optional):
Bind Host []:ENTER
Bind Port []:ENTER

Accept config from parent node? [y/N]:ENTER
Accept commands from parent node? [y/N]: y

Re-configuring Icinga...

Local zone name [172.104.149.69]:ENTER
Parent zone name [master]:ENTER

Default global zones: global-templates director-global
Do you want to specify additional global zones? [y/N]:ENTER

Do you want to disable the inclusion of the conf.d directory [Y/n]:ENTER
Disabling the inclusion of the conf.d directory...

Done.

Now restart your Icinga 2 daemon to finish the installation!

sudo systemctl restart icinga2

---

Again login to Icinga master and add a config file.

As rootl;

cd /etc/icinga2/zones.d/
cp 172-104-149-69.conf  < instance IP; replace . with - >

Update following configs;

object Endpoint "10.147.18.76" {
       host = "10.147.18.76"
}

object Zone "10.147.18.76" {
	endpoints = [ "10.147.18.76" ]
	parent = "master"
}

object Host "10.147.18.76" {
  //import "generic-host"
  max_check_attempts = 3
  check_interval = 1m
  retry_interval = 30s

  check_command = "hostalive"
  address = "10.147.18.76"

  display_name = "DIsplay name"
  vars.os = "Linux"
  vars.ping_wrta=200

  vars.client_endpoint = name

  vars.disks["disk"] = {
    /* No parameters. */
  }
  vars.disks["disk /"] = {
    disk_partitions = "/"
  }
  vars.disk_wfree = "25%"
  vars.disk_wfree = "25%"
  vars.swap_cfree = "10%"
  vars.swap_cfree = "10%"
  vars.load_wload1 = 5
  vars.load_wload5 = 4
  vars.load_wload15 = 3
  vars.load_cload1 = 10
  vars.load_cload5 = 8
  vars.load_cload15 = 6
  vars.load_percpu = true
// To enable process monitoring, set options by providing [gaiad,iris,terrad] values
  vars.application_type = "gaiad"
  vars.zerotier = "true"
  vars.fail2ban = "true"
  vars.ssh_port = 22

  /* Define notification mail attributes for notification apply rules in `notifications.conf`. */
  vars.notification["mail"] = {
    /* The UserGroup `icingaadmins` is defined in `users.conf`. */
    groups = [ "icingaadmins" ]
  }
}

sudo systemctl restart icinga2
